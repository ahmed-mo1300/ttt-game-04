const game=document.body.querySelector(".ttt-game"),grid={},icons={x:game.querySelector("#icon-x"),o:game.querySelector("#icon-o")},scores={x:{aheadIcon:game.querySelector("#player-icon--ahead"),behindIcon:game.querySelector("#player-icon--behind"),el:game.querySelector("#score-x"),score:0},o:{el:game.querySelector("#score-o"),score:0}};let paused=!1;const players=["x","o"];for(let t=1;t<=3;t++)for(let e=1;e<=3;e++){const c=game.querySelector(`.ttt-row:nth-child(${t}) .ttt-cell:nth-child(${e})`);c.dataset.x=e,c.dataset.y=t,c.addEventListener("click",cellClickEvent),grid[t]=grid[t]||{},grid[t][e]={x:e,y:t,el:c,value:""}}function cellClickEvent(e){var t;paused||(e=grid[e.target.dataset.y][e.target.dataset.x]).value||(paused=!0,fillCell(e,"o"),{winner:e,empty:t}=check(),e)||play(t)}function fillCell(e,t){e.value=t;t=icons[t].cloneNode(!0);e.el.appendChild(t)}function check(e){var o=[];const l={player:null,cells:[]};for(const d of["y","x"]){var r={o:[],x:[]};for(let t=1;t<=3;t++){var c=t,s="y"===d?c:4-c,c=grid[c][s],a=(c.value&&r[c.value].push(c),{o:[],x:[]});for(let e=1;e<=3;e++){var n="y"===d?t:e,i="y"===d?e:t,n=grid[n][i];(n.value?a[n.value]:o).push(n)}checkLine(a,l)}checkLine(r,l)}return e||(paused=!0,l.player?(scores[l.player].score++,l.cells.forEach(({el:e})=>e.classList.add("ttt-blink")),setTimeout(()=>{l.cells.forEach(({el:e})=>e.classList.remove("ttt-blink")),reset()},1200)):o.length||setTimeout(()=>{reset()},1200)),{winner:l.player,empty:[...new Set(o)]}}function checkLine(e,t){for(const o of players)3===e[o].length&&(t.player=o,t.cells.push(...e[o]))}function play(c){setTimeout(()=>{let e=!1;e:for(const l of players)for(const r of c){r.value=l;const{winner:t,empty:o}=check(!0);if(t||!o){e=!0,fillCell(r,"x");break e}r.value=""}e||fillCell(c[Math.round(Math.random()*(c.length-1))],"x");const{winner:t,empty:o}=check();!t&&o&&(paused=!1)},400)}function reset(){scores.x.el.textContent=scores.x.score.toString(),scores.o.el.textContent=scores.o.score.toString(),scores.x.aheadIcon.classList[scores.x.score<scores.o.score?"add":"remove"]("icon-hidden"),scores.x.behindIcon.classList[scores.x.score>=scores.o.score?"add":"remove"]("icon-hidden");for(let t=1;t<=3;t++)for(let e=1;e<=3;e++){var o=grid[t][e];o.el.firstChild&&o.el.removeChild(o.el.firstChild),o.value=""}var e=check()["empty"];play(e)}reset();